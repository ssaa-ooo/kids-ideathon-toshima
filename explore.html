<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è±Šå³¶åŒºã®ã€ŒãŠé¡Œã€ã‚’æ¢æ¤œã—ã‚ˆã†ï¼ï½œã¨ã—ã¾ã‚­ãƒƒã‚ºã‚¢ã‚¤ãƒ‡ã‚¢ã‚½ãƒ³</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            color: #333;
            background-color: #f0f9ff;
        }
        .adventure-card:hover {
            transform: scale(1.02) rotate(1deg);
            transition: all 0.3s ease;
        }
        .map-bg {
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .ai-shimmer {
            background: linear-gradient(90deg, #eff6ff 25%, #dbeafe 50%, #eff6ff 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        .break-phrase {
            display: inline-block;
        }
        #mobile-menu-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }
        #mobile-menu-content.active {
            transform: translateX(0);
        }
    </style>
</head>
<body class="antialiased map-bg text-slate-800">

    <!-- Header / Navigation -->
    <header class="bg-white/80 backdrop-blur-md border-b sticky top-0 z-50">
        <div class="container mx-auto px-4 md:px-6 py-3 flex justify-between items-center text-slate-800">
            <a href="index.html" class="text-base md:text-xl font-black tracking-tighter text-blue-600 leading-none z-50">
                ã¨ã—ã¾ã‚­ãƒƒã‚º<span class="text-orange-500">ã‚¢ã‚¤ãƒ‡ã‚¢ã‚½ãƒ³</span>
            </a>
            
            <nav class="hidden lg:flex space-x-6 text-slate-800">
                <a href="index.html#about" class="text-sm font-bold text-gray-600 hover:text-blue-600">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã¯</a>
                <a href="index.html#workflow" class="text-sm font-bold text-gray-600 hover:text-blue-600">æŒ‘æˆ¦ã®æµã‚Œ</a>
                <a href="index.html#schedule" class="text-sm font-bold text-gray-600 hover:text-blue-600">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</a>
                <a href="support.html" class="text-sm font-bold text-blue-600 hover:text-blue-800">ä¼æ¥­ã®çš†æ§˜ã¸</a>
            </nav>

            <div class="flex items-center gap-3">
                <a href="explore.html" class="hidden sm:block bg-orange-500 text-white px-3 md:px-4 py-1.5 md:py-2 rounded-full text-xs md:text-sm font-bold shadow-lg hover:bg-orange-600 transition text-white">è¡—ã‚’æ¢æ¤œã—ã¦ã¿ã‚‹</a>
                <button id="menu-btn" class="lg:hidden w-10 h-10 flex flex-col justify-center items-center gap-1.5 z-50 focus:outline-none">
                    <span class="w-6 h-0.5 bg-blue-600 transition-transform duration-300"></span>
                    <span class="w-6 h-0.5 bg-blue-600 transition-opacity duration-300"></span>
                    <span class="w-6 h-0.5 bg-blue-600 transition-transform duration-300"></span>
                </button>
            </div>
        </div>
    </header>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu-overlay" class="fixed inset-0 bg-blue-900/40 backdrop-blur-sm z-[60] opacity-0 pointer-events-none transition-opacity duration-300 lg:hidden text-slate-800">
        <div id="mobile-menu-content" class="absolute right-0 top-0 h-full w-4/5 max-w-sm bg-white shadow-2xl transform translate-x-full transition-transform duration-300 ease-out flex flex-col p-8 text-slate-800">
            <div class="mt-12 space-y-6 text-slate-800">
                <a href="index.html" class="block text-lg font-black text-slate-800 border-b pb-4 text-slate-800">ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸</a>
                <a href="index.html#about" class="mobile-nav-link block text-lg font-bold text-slate-600">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã¯</a>
                <a href="index.html#workflow" class="mobile-nav-link block text-lg font-bold text-slate-600">æŒ‘æˆ¦ã®æµã‚Œ</a>
                <a href="index.html#schedule" class="mobile-nav-link block text-lg font-bold text-slate-600">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</a>
                <a href="support.html" class="mobile-nav-link block text-lg font-bold text-blue-600 text-blue-600">ä¼æ¥­ã®çš†æ§˜ã¸</a>
                <a href="explore.html" class="mobile-nav-link block text-lg font-bold text-orange-500 text-orange-500 text-orange-500">è¡—ã‚’æ¢æ¤œã—ã¦ã¿ã‚‹</a>
            </div>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="py-12 md:py-20 px-6 text-center text-slate-800">
        <div class="container mx-auto max-w-4xl">
            <span class="inline-block bg-yellow-400 text-yellow-900 px-4 py-1 rounded-full text-xs md:text-sm font-bold mb-6 shadow-sm tracking-wide text-yellow-900">MISSION: è¡—ã®ã€ŒãŠé¡Œã€ã‚’è¦‹ã¤ã‘ã‚ˆã†ï¼</span>
            <h1 class="text-3xl md:text-6xl font-black mb-6 md:mb-8 leading-tight text-slate-900">
                <span class="break-phrase text-slate-900">ãã¿ã¯</span><span class="break-phrase text-slate-900">ã€Œè¡—ã®æ¢æ¤œå®¶ã€ã ï¼</span><br>
                <span class="text-blue-600 italic">Toshima Adventure</span>
            </h1>
            <p class="text-base md:text-xl text-slate-700 mb-8 leading-relaxed font-medium">
                è±Šå³¶åŒºã®æœªæ¥ã‚’è€ƒãˆã‚‹ãŸã‚ã®ã€ŒãŠé¡Œã€ã‚’AIã¨ä¸€ç·’ã«æ¢ã—ã¦ã¿ã‚ˆã†ã€‚<br>
                ãã¿ã®å¥½ããªã“ã¨ã‚„ã€è¡—ã§è¦‹ã¤ã‘ãŸã“ã¨ã‚’æ•™ãˆã¦ã­ï¼
            </p>
        </div>
    </section>

    <!-- 7 Directions Section -->
    <section class="px-6 mb-16">
        <div class="container mx-auto max-w-6xl">
            <div class="text-center mb-10">
                <h2 class="text-xl md:text-2xl font-black text-blue-800 bg-blue-100 inline-block px-6 py-2 rounded-full">
                    æ¢æ¤œã®ãƒ’ãƒ³ãƒˆï¼š7ã¤ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³
                </h2>
            </div>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 text-slate-800">
                <div class="adventure-card bg-white p-6 rounded-[2rem] shadow-lg border-b-4 border-pink-400 text-slate-800">
                    <div class="text-4xl mb-4">ğŸ’</div>
                    <h3 class="font-bold text-pink-700 mb-2">å­¦æ ¡ãƒ»éŠã³å ´ã‚’ã‚‚ã£ã¨æ¥½ã—ãï¼</h3>
                    <p class="text-xs text-slate-500 leading-relaxed text-slate-500">æ”¾èª²å¾ŒãŒã‚‚ã£ã¨ãƒ¯ã‚¯ãƒ¯ã‚¯ã™ã‚‹ã«ã¯ï¼Ÿã¿ã‚“ãªãŒæ¥½ã—ãå­¦ã¹ã‚‹ä»•çµ„ã¿ã‚’è€ƒãˆã‚ˆã†ã€‚</p>
                </div>
                <div class="adventure-card bg-white p-6 rounded-[2rem] shadow-lg border-b-4 border-red-400 text-slate-800">
                    <div class="text-4xl mb-4 text-slate-800">ğŸ›¡ï¸</div>
                    <h3 class="font-bold text-red-700 mb-2 text-red-700">è¡—ã®ã€Œå®‰å¿ƒã€ã‚’å®ˆã‚ŠæŠœã“ã†ï¼</h3>
                    <p class="text-xs text-slate-500 leading-relaxed text-slate-500 text-slate-500">åœ°éœ‡ã®æ™‚ã©ã†ã™ã‚‹ï¼Ÿå¤œé“ã§æš—ã„ã¨ã“ã‚ã¯ãªã„ï¼Ÿã¿ã‚“ãªã‚’å®ˆã‚‹ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’æ¢ãã†ã€‚</p>
                </div>
                <div class="adventure-card bg-white p-6 rounded-[2rem] shadow-lg border-b-4 border-yellow-400 text-slate-800">
                    <div class="text-4xl mb-4 text-slate-800 text-slate-800">ğŸ˜Š</div>
                    <h3 class="font-bold text-yellow-700 mb-2 text-yellow-700">ã¿ã‚“ãªã®ã€Œç¬‘é¡”ã€ã‚’å¢—ã‚„ãã†ï¼</h3>
                    <p class="text-xs text-slate-500 leading-relaxed text-slate-500 text-slate-500">èµ¤ã¡ã‚ƒã‚“ã‹ã‚‰ãŠå¹´å¯„ã‚Šã¾ã§ã€å›°ã£ã¦ã„ã‚‹äººã¯ã„ãªã„ã‹ãªï¼ŸåŠ©ã‘åˆã„ã®ç¨®ã‚’æ¢ãã†ã€‚</p>
                </div>
                <div class="adventure-card bg-white p-6 rounded-[2rem] shadow-lg border-b-4 border-orange-400 text-slate-800">
                    <div class="text-4xl mb-4 text-slate-800 text-slate-800 text-slate-800">ğŸ¬</div>
                    <h3 class="font-bold text-orange-700 mb-2 text-orange-700">å•†åº—è¡—ã‚’å…ƒæ°—ã„ã£ã±ã„ã«ï¼</h3>
                    <p class="text-xs text-slate-500 leading-relaxed text-slate-500 text-slate-500">ãã¿ã®å¥½ããªãŠåº—ã‚’å¿œæ´ï¼æ–°ã—ã„ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚„æ¥½ã—ã„çœ‹æ¿ã‚’è€ƒãˆã¦ã¿ã‚ˆã†ã€‚</p>
                </div>
                <div class="adventure-card bg-white p-6 rounded-[2rem] shadow-lg border-b-4 border-green-400 text-slate-800 text-slate-800">
                    <div class="text-4xl mb-4 text-slate-800 text-slate-800 text-slate-800 text-slate-800">ğŸŒ¿</div>
                    <h3 class="font-bold text-green-700 mb-2 text-green-700 text-green-700">åœ°çƒã¨ã¿ã©ã‚Šã‚’å®ˆã‚‹ãƒŸãƒƒã‚·ãƒ§ãƒ³</h3>
                    <p class="text-xs text-slate-500 leading-relaxed text-slate-500 text-slate-500 text-slate-500">ã‚´ãƒŸã‚’æ¸›ã‚‰ã™ã«ã¯ï¼Ÿå…¬åœ’ã®ç·‘ã‚’ã‚‚ã£ã¨å¢—ã‚„ã™ã«ã¯ï¼Ÿåœ°çƒã«ã‚„ã•ã—ã„è¡—ã«ã—ã‚ˆã†ã€‚</p>
                </div>
                <div class="adventure-card bg-white p-6 rounded-[2rem] shadow-lg border-b-4 border-purple-400 text-slate-800">
                    <div class="text-4xl mb-4 text-slate-800">ğŸ¨</div>
                    <h3 class="font-bold text-purple-700 mb-2 text-purple-700 text-purple-700">ã‚¢ãƒ¼ãƒˆã¨ã‚¢ãƒ‹ãƒ¡ã§ç››ã‚Šä¸Šã’ã‚ˆã†ï¼</h3>
                    <p class="text-xs text-slate-500 leading-relaxed text-slate-500 text-slate-500">ãƒãƒ³ã‚¬ã‚„ã‚¢ãƒ‹ãƒ¡ã€æ–‡åŒ–ã®åŠ›ã§ã€ä¸–ç•Œä¸­ã®äººã‚’ã€ŒãŠã‚‚ã¦ãªã—ã€ã™ã‚‹å·¥å¤«ã¯ãªã„ã‹ãªï¼Ÿ</p>
                </div>
                <div class="adventure-card bg-white p-6 rounded-[2rem] shadow-lg border-b-4 border-blue-400 sm:col-span-2 lg:col-span-1 text-slate-800 text-slate-800 text-slate-800 text-slate-800">
                    <div class="text-4xl mb-4 text-slate-800 text-slate-800 text-slate-800 text-slate-800 text-slate-800">ğŸšŒ</div>
                    <h3 class="font-bold text-blue-700 mb-2 text-blue-700 text-blue-700">æœªæ¥ã®ã€Œä¹—ã‚Šç‰©ãƒ»åºƒå ´ã€ã‚’è€ƒãˆã‚ˆã†</h3>
                    <p class="text-xs text-slate-500 leading-relaxed text-slate-500 text-slate-500 text-slate-500">ã‚¤ã‚±ãƒã‚¹ã‚„å…¬åœ’ã®åºƒå ´ã‚’ã€ã‚‚ã£ã¨ä½¿ã„ã‚„ã™ãã€ã‚‚ã£ã¨ä¾¿åˆ©ã«ã™ã‚‹æ–¹æ³•ã¯ãªã„ã‹ãªï¼Ÿ</p>
                </div>
            </div>
        </div>
    </section>

    <!-- AI Adventure Mentor Section -->
    <section class="px-6 mb-20 text-slate-800">
        <div class="container mx-auto max-w-3xl text-slate-800">
            <div class="bg-white p-6 md:p-12 rounded-[2.5rem] md:rounded-[3rem] shadow-2xl border-4 border-blue-200 relative overflow-hidden text-slate-800 text-slate-800">
                <div class="absolute top-0 right-0 p-4 opacity-5 text-slate-800">
                    <svg class="w-24 h-24" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"/></svg>
                </div>
                
                <h2 class="text-xl md:text-3xl font-black mb-6 text-blue-700 flex items-center gap-3">
                    <span>âœ¨</span> AIã‚¢ãƒ‰ãƒ™ãƒ³ãƒãƒ£ãƒ¼ãƒ»ãƒ¡ãƒ³ã‚¿ãƒ¼
                </h2>
                <p class="mb-8 font-bold text-slate-600 text-sm md:text-base leading-relaxed text-slate-600">
                    è¡—ã§è¦‹ã¤ã‘ãŸã“ã¨ã‚„ã€ãã¿ãŒæ°—ã«ãªã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æ•™ãˆã¦ï¼<br>
                    è±Šå³¶åŒºã®ã€ŒåŸºæœ¬è¨ˆç”»ã€ã®ä¸­ã‹ã‚‰ã€ãã¿ã«ã´ã£ãŸã‚Šã®ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œã‚‹ã‚ˆã€‚
                </p>
                <div class="space-y-6 text-slate-800 text-slate-800">
                    <div>
                        <label class="block text-xs md:text-sm font-black mb-2 text-blue-600 text-blue-600">ãã¿ã®å¥½ããªã“ã¨ã€ã¾ãŸã¯è¡—ã§è¦‹ã¤ã‘ãŸã“ã¨ã‚’æ•™ãˆã¦ï¼</label>
                        <textarea id="aiInput" class="w-full p-4 border-2 border-slate-200 rounded-2xl focus:border-blue-500 focus:outline-none transition min-h-[120px] text-slate-800 text-sm md:text-base" placeholder="ä¾‹ï¼šã‚¢ãƒ‹ãƒ¡ãŒå¥½ãã€å…¬åœ’ã«ã‚´ãƒŸãŒã‚ã£ãŸã€ãŠèŠ±ã‚’å¢—ã‚„ã—ãŸã„ã€ãªã©"></textarea>
                    </div>
                    <button id="generateBtn" onclick="generateMission()" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black text-lg md:text-xl shadow-lg hover:bg-blue-700 transition transform active:scale-95 flex items-center justify-center gap-3 text-white text-white text-white">
                        ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆã™ã‚‹ ğŸš€
                    </button>
                </div>

                <div id="resultArea" class="mt-8 md:mt-10 hidden text-slate-800 text-slate-800">
                    <div id="loading" class="ai-shimmer h-32 rounded-2xl flex items-center justify-center font-bold text-blue-600 text-sm md:text-base">
                        è±Šå³¶åŒºã®æœªæ¥ã‚’ã‚¹ã‚­ãƒ£ãƒ³ä¸­...
                    </div>
                    <div id="missionContent" class="hidden text-slate-800 text-slate-800">
                        <div class="bg-orange-50 p-6 rounded-3xl border-2 border-orange-200 text-slate-800 text-slate-800 text-slate-800">
                            <span class="inline-block bg-orange-500 text-white px-3 py-1 rounded-full text-[10px] font-bold mb-3 uppercase tracking-wider text-white">Your Mission</span>
                            <div id="missionText" class="text-base md:text-lg font-bold text-slate-800 leading-relaxed whitespace-pre-wrap"></div>
                            <div class="mt-6 pt-6 border-t border-orange-200 text-slate-800 text-slate-800 text-slate-800">
                                <p class="text-xs md:text-sm font-bold text-orange-700 mb-2 text-orange-700 text-orange-700 text-orange-700">ğŸ’¡ ãƒ¡ãƒ³ã‚¿ãƒ¼ã‹ã‚‰ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹</p>
                                <div id="mentorAdvice" class="text-xs md:text-sm text-slate-600 leading-relaxed text-slate-600 text-slate-600 text-slate-600 text-slate-600"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="py-12 md:py-20 px-6 bg-gray-900 text-white text-center">
        <div class="container mx-auto max-w-5xl text-white">
            <h2 class="text-xl md:text-2xl font-bold mb-8 text-white text-white text-white">é‹å–¶äº‹å‹™å±€ãƒ»ãŠå•ã„åˆã‚ã›</h2>
            <div class="space-y-2 text-gray-300 text-xs md:text-sm mb-12 text-slate-300 text-slate-300">
                <p><strong>ä¸»å‚¬ï¼š</strong> è±Šå³¶åŒºï¼ˆåŒºæ°‘éƒ¨ åœ°åŸŸåŒºæ°‘ã²ã‚ã°èª² äº‹æ¥­ã‚°ãƒ«ãƒ¼ãƒ—ï¼‰</p>
                <p><strong>é‹å–¶ï¼š</strong> æ ªå¼ä¼šç¤¾SSAA</p>
            </div>
            <div class="flex flex-col items-center">
                <p class="text-[10px] md:text-xs text-gray-400 mb-2 uppercase tracking-widest text-slate-400 text-slate-400">Inquiry</p>
                <p class="text-2xl md:text-3xl font-black mb-8 text-blue-400 tracking-tighter text-blue-400 text-blue-400 text-blue-400">toshima-ideathon@ssaa.ooo</p>
                <a href="https://docs.google.com/forms/d/e/1FAIpQLScArGkIh-Mm3Twksi7stpZiE2qManY7njfPVLlRDv1rK-x54Q/viewform?usp=header" target="_blank" class="inline-block bg-white text-gray-900 px-10 py-4 rounded-full font-bold text-sm md:text-base hover:bg-blue-100 transition shadow-xl text-slate-900 text-slate-900">ãƒ•ã‚©ãƒ¼ãƒ ã§å•ã„åˆã‚ã›ã‚‹</a>
            </div>
            <div class="text-center text-gray-600 text-[10px] md:text-sm mt-16 pt-8 border-t border-gray-800 tracking-widest text-slate-600 text-slate-600 text-slate-600">
                &copy; Toshima Kids Ideathon Executive Committee / SSAA Inc. All Rights Reserved.
            </div>
        </div>
    </footer>

    <script>
        // ã”æä¾›ã„ãŸã ã„ãŸAPIã‚­ãƒ¼ã‚’è¨­å®šã—ã¾ã—ãŸ
        const apiKey = "AIzaSyCM2iIj7ngDfdGswjjkSABEokwGsZG50n4"; 

        // Mobile Menu
        const menuBtn = document.getElementById('menu-btn');
        const overlay = document.getElementById('mobile-menu-overlay');
        const content = document.getElementById('mobile-menu-content');
        const spans = menuBtn.querySelectorAll('span');

        function toggleMenu() {
            const isActive = content.classList.contains('active');
            if (!isActive) {
                overlay.classList.add('active'); content.classList.add('active');
                spans[0].style.transform = 'rotate(45deg) translate(5px, 5px)';
                spans[1].style.opacity = '0';
                spans[2].style.transform = 'rotate(-45deg) translate(5px, -5px)';
            } else {
                overlay.classList.remove('active'); content.classList.remove('active');
                spans[0].style.transform = 'none'; spans[1].style.opacity = '1'; spans[2].style.transform = 'none';
            }
        }
        menuBtn.addEventListener('click', toggleMenu);

        // AI Logic
        async function generateMission() {
            const input = document.getElementById('aiInput').value;
            if (!input) {
                alert("æ¢æ¤œã—ãŸã„ã“ã¨ã‚’å…¥åŠ›ã—ã¦ã­ï¼");
                return;
            }

            const generateBtn = document.getElementById('generateBtn');
            const resultArea = document.getElementById('resultArea');
            const loading = document.getElementById('loading');
            const missionContent = document.getElementById('missionContent');

            generateBtn.disabled = true;
            resultArea.classList.remove('hidden');
            loading.classList.remove('hidden');
            missionContent.classList.add('hidden');

            const systemPrompt = `ã‚ãªãŸã¯è±Šå³¶åŒºã®æœªæ¥ã‚’ä¸€ç·’ã«è€ƒãˆã‚‹ã€Œã‚¢ãƒ‰ãƒ™ãƒ³ãƒãƒ£ãƒ¼ãƒ»ãƒ¡ãƒ³ã‚¿ãƒ¼ã€ã§ã™ã€‚
è±Šå³¶åŒºã®åŸºæœ¬è¨ˆç”»ï¼ˆå­¦æ ¡ãƒ»éŠã³å ´ã€å®‰å¿ƒãƒ»å®‰å…¨ã€ç¦ç¥‰ã€å•†åº—è¡—ã€ç’°å¢ƒã€ã‚«ãƒ«ãƒãƒ£ãƒ¼ã€éƒ½å¸‚æ•´å‚™ï¼‰ã‚’èƒŒæ™¯ã«ã€å­ã©ã‚‚ã®å…¥åŠ›ã«åˆã‚ã›ã¦æ¢æ¤œãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’ææ¡ˆã—ã¦ãã ã•ã„ã€‚
ã€å›ç­”ãƒ«ãƒ¼ãƒ«ã€‘
- å°å­¦æ ¡é«˜å­¦å¹´å‘ã‘ã«ãƒ¯ã‚¯ãƒ¯ã‚¯ã™ã‚‹è¨€è‘‰ä½¿ã„ã§ã€‚
- å¿…ãšä»¥ä¸‹ã®ç´”ç²‹ãªJSONå½¢å¼ã®ã¿ã§ç­”ãˆã¦ãã ã•ã„ã€‚Markdownã®è£…é£¾ï¼ˆ\`\`\`jsonãªã©ï¼‰ã¯çµ¶å¯¾ã«å«ã‚ãªã„ã§ãã ã•ã„ã€‚
{"missionTitle": "...", "missionDescription": "...", "advice": "..."}`;

            let retryCount = 0;
            const maxRetries = 5;

            while (retryCount < maxRetries) {
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: `å­ã©ã‚‚ã®å…¥åŠ›ï¼š${input}` }] }],
                            systemInstruction: { parts: [{ text: systemPrompt }] },
                            generationConfig: { 
                                responseMimeType: "application/json"
                            }
                        })
                    });

                    if (!response.ok) throw new Error('API Error');

                    const data = await response.json();
                    let rawText = data.candidates[0].content.parts[0].text;
                    
                    // JSONãƒ‘ãƒ¼ã‚¹å‰ã«ä¸è¦ãªè£…é£¾ã‚’å¿µå…¥ã‚Šã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
                    const jsonText = rawText.replace(/```json/g, '').replace(/```/g, '').trim();
                    const result = JSON.parse(jsonText);

                    document.getElementById('missionText').innerText = result.missionTitle + "\n\n" + result.missionDescription;
                    document.getElementById('mentorAdvice').innerText = result.advice;
                    
                    loading.classList.add('hidden');
                    missionContent.classList.remove('hidden');
                    generateBtn.disabled = false;
                    return;

                } catch (error) {
                    retryCount++;
                    await new Promise(r => setTimeout(r, Math.pow(2, retryCount) * 1000));
                    if (retryCount === maxRetries) {
                        alert("AIãŒå°‘ã—æ··ã¿åˆã£ã¦ã„ã‚‹ã¿ãŸã„ã€‚æ™‚é–“ã‚’ãŠã„ã¦ã‚‚ã†ä¸€åº¦è©¦ã—ã¦ã­ï¼");
                        generateBtn.disabled = false;
                        loading.classList.add('hidden');
                    }
                }
            }
        }
    </script>
</body>
</html>
